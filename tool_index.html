<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Tools Kit Komunitas - NFT Powered Toolkit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <style>
        /* Existing styles remain unchanged */
        /* Adding a few new styles for enhanced UI */
        
        .tool-card {
            position: relative;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            font-size: 1.5rem;
        }
        
        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .wallet-connected {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <!-- Existing HTML structure remains unchanged until the end of the main content -->
    
    <!-- Add a loading overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner"></div>
        <span>Loading...</span>
    </div>

    <script>
        // Package.json simulation - This would be a separate file in a real project
        const packageConfig = {
            name: "advanced-tools-kit-komunitas",
            version: "1.0.0",
            description: "NFT Powered Community Toolkit with Web3 Integration",
            main: "advance_index.html",
            scripts: {
                "start": "node server.js",
                "dev": "live-server --port=3000",
                "build": "echo 'Build process would go here'",
                "test": "echo 'Test would go here'"
            },
            dependencies: {
                "express": "^4.18.2",
                "web3": "^1.8.0",
                "xlsx": "^0.18.5",
                "cors": "^2.8.5",
                "dotenv": "^16.0.3"
            },
            devDependencies: {
                "live-server": "^1.2.2",
                "nodemon": "^2.0.20"
            },
            keywords: ["nft", "tools", "web3", "blockchain", "community"],
            author: "Tools Kit Komunitas Team",
            license: "MIT"
        };

        // Enhanced tools data with more properties for filtering
        const toolsData = [
            {
                id: 1,
                name: "Konverter Excel ke JSON",
                description: "Unggah file Excel atau CSV dan konversi ke format JSON dengan mudah.",
                icon: "fas fa-exchange-alt",
                category: "converter",
                url: "jsonconverted2.html",
                isNft: false,
                popularity: 95,
                requiresAuth: false,
                tags: ["data", "conversion", "excel", "json"]
            },
            {
                id: 2,
                name: "Glide Tools Suite",
                description: "Generator link Google Drive untuk Glide + Arsip PDF/Excel dengan viewer.",
                icon: "fas fa-table",
                category: "glide",
                url: "glide_tools_suite.html",
                isNft: true,
                popularity: 88,
                requiresAuth: true,
                tags: ["glide", "google drive", "pdf", "excel", "viewer"]
            },
            // More tools with enhanced metadata...
        ];

        // Enhanced NFT data
        const nftData = [
            {
                id: 1,
                name: "Glide Pro Tools",
                description: "Koleksi tools profesional untuk Google Glide",
                image: "https://via.placeholder.com/300x200/4f46e5/ffffff?text=Glide+Pro",
                price: "0.5 ETH",
                owner: "0x1234...abcd",
                attributes: [
                    { trait_type: "Category", value: "Productivity" },
                    { trait_type: "Access Level", value: "Premium" }
                ]
            },
            // More NFT items...
        ];

        // User data and preferences
        let userData = {
            connected: false,
            address: null,
            network: null,
            favoriteTools: [],
            ownedNFTs: [],
            preferences: {
                darkMode: false,
                notifications: true
            }
        };

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const themeToggle = document.getElementById('themeToggle');
        const navItems = document.querySelectorAll('.nav-item');
        const sectionContents = document.querySelectorAll('.section-content');
        const toolsGrid = document.querySelector('.tools-grid');
        const nftGallery = document.querySelector('.nft-gallery');
        const web3Connect = document.getElementById('web3Connect');
        const web3Modal = document.getElementById('web3Modal');
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Initialize the dashboard
        function initDashboard() {
            // Load user data from local storage
            loadUserData();
            
            // Load popular tools
            renderPopularTools();
            
            // Load NFT items
            renderNftItems();
            
            // Set up event listeners
            setupEventListeners();
            
            // Check if Web3 is available
            checkWeb3Availability();
            
            // Update UI based on user data
            updateUI();
        }

        // Load user data from local storage
        function loadUserData() {
            const savedData = localStorage.getItem('toolkitUserData');
            if (savedData) {
                userData = JSON.parse(savedData);
                console.log('User data loaded from storage');
            }
        }

        // Save user data to local storage
        function saveUserData() {
            localStorage.setItem('toolkitUserData', JSON.stringify(userData));
            console.log('User data saved to storage');
        }

        // Update UI based on user data
        function updateUI() {
            // Update theme
            if (userData.preferences.darkMode) {
                document.body.classList.add('dark-mode');
                themeToggle.querySelector('i').classList.remove('fa-moon');
                themeToggle.querySelector('i').classList.add('fa-sun');
            }
            
            // Update wallet connection status
            if (userData.connected) {
                web3Connect.innerHTML = `<i class="fas fa-check-circle"></i> ${userData.address.substring(0, 8)}...`;
                web3Connect.className = 'wallet-connected';
                connectWalletBtn.innerHTML = '<i class="fas fa-wallet"></i> Wallet Connected';
            }
        }

        // Enhanced tool rendering with favorites
        function renderPopularTools() {
            // Clear existing content
            toolsGrid.innerHTML = '';
            
            // Sort tools by popularity and get top 4
            const popularTools = [...toolsData].sort((a, b) => b.popularity - a.popularity).slice(0, 4);
            
            // Generate tool cards
            popularTools.forEach(tool => {
                const isFavorite = userData.favoriteTools.includes(tool.id);
                const toolCard = document.createElement('div');
                toolCard.className = 'tool-card';
                toolCard.innerHTML = `
                    ${tool.isNft ? '<div class="nft-badge">NFT</div>' : ''}
                    <div class="tool-header">
                        <i class="${tool.icon}"></i>
                        <h3 class="tool-title">${tool.name}</h3>
                    </div>
                    <div class="tool-body">
                        <p class="tool-desc">${tool.description}</p>
                        <div class="tool-meta">
                            <span>${tool.popularity}% populer</span>
                            <span>${tool.category}</span>
                        </div>
                        <span class="tool-tag">#${tool.category}</span>
                        <div class="tool-actions" style="margin-top: 10px; display: flex; justify-content: space-between;">
                            <button class="btn btn-primary" data-tool-id="${tool.id}">Buka Tool</button>
                            <button class="btn btn-secondary favorite-btn ${isFavorite ? 'active' : ''}" data-tool-id="${tool.id}">
                                <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                toolsGrid.appendChild(toolCard);
            });
            
            // Add event listeners for tool actions
            document.querySelectorAll('[data-tool-id]').forEach(btn => {
                if (btn.classList.contains('favorite-btn')) {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavorite(parseInt(btn.dataset.toolId));
                    });
                } else {
                    btn.addEventListener('click', () => {
                        const toolId = parseInt(btn.dataset.toolId);
                        const tool = toolsData.find(t => t.id === toolId);
                        if (tool) {
                            if (tool.requiresAuth && !userData.connected) {
                                alert('Tool ini memerlukan koneksi wallet untuk mengakses');
                                web3Modal.style.display = 'flex';
                            } else {
                                window.open(tool.url, '_blank');
                            }
                        }
                    });
                }
            });
        }

        // Toggle tool as favorite
        function toggleFavorite(toolId) {
            const index = userData.favoriteTools.indexOf(toolId);
            if (index === -1) {
                userData.favoriteTools.push(toolId);
            } else {
                userData.favoriteTools.splice(index, 1);
            }
            saveUserData();
            renderPopularTools(); // Refresh the display
        }

        // Simulate API calls
        async function simulateAPIcall(endpoint, data = null) {
            showLoading();
            try {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Simulate different API responses based on endpoint
                switch(endpoint) {
                    case '/user/profile':
                        return { success: true, data: userData };
                    case '/tools/list':
                        return { success: true, data: toolsData };
                    case '/nft/marketplace':
                        return { success: true, data: nftData };
                    case '/web3/connect':
                        // Simulate wallet connection
                        userData.connected = true;
                        userData.address = '0x' + Math.random().toString(16).substr(2, 40);
                        userData.network = 'Ethereum Mainnet';
                        saveUserData();
                        return { success: true, data: userData };
                    case '/web3/disconnect':
                        userData.connected = false;
                        userData.address = null;
                        userData.network = null;
                        saveUserData();
                        return { success: true, data: userData };
                    default:
                        return { success: true, data: {} };
                }
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, error: error.message };
            } finally {
                hideLoading();
            }
        }

        // Show loading overlay
        function showLoading() {
            loadingOverlay.style.display = 'flex';
        }

        // Hide loading overlay
        function hideLoading() {
            loadingOverlay.style.display = 'none';
        }

        // Enhanced Web3 connection function
        async function connectWeb3() {
            const result = await simulateAPIcall('/web3/connect');
            if (result.success) {
                showNotification('Wallet connected successfully!', 'success');
                updateUI();
            } else {
                showNotification('Failed to connect wallet: ' + result.error, 'error');
            }
        }

        // Enhanced Web3 disconnection function
        async function disconnectWeb3() {
            const result = await simulateAPIcall('/web3/disconnect');
            if (result.success) {
                showNotification('Wallet disconnected', 'success');
                updateUI();
            }
        }

        // Show notification toast
        function showNotification(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Add to document
            document.body.appendChild(toast);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // The rest of your existing functions with enhancements...

        // Initialize the dashboard when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initDashboard);

        // Load saved theme from localStorage
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            themeToggle.querySelector('i').classList.remove('fa-moon');
            themeToggle.querySelector('i').classList.add('fa-sun');
            userData.preferences.darkMode = true;
            saveUserData();
        }
    </script>
</body>
</html>