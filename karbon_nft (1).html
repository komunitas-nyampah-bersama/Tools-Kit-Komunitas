<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Jejak Karbon Pribadi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #27ae60;
            --primary-dark: #219653;
            --secondary: #2c3e50;
            --accent: #3498db;
            --danger: #e74c3c;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --border: #dee2e6;
            --success-bg: #d4edda;
            --info-bg: #d1ecf1;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            background-color: rgba(255, 255, 255, 0.97);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
            position: relative;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 48px;
        }
        
        h1 {
            color: var(--secondary);
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .intro {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--gray);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 992px) {
            .form-container {
                grid-template-columns: 1fr;
            }
        }
        
        .form-section {
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
        }
        
        .form-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-section h2 i {
            background: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--secondary);
        }
        
        input[type="text"],
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 16px;
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(39, 174, 96, 0.4);
        }
        
        button.secondary {
            background: linear-gradient(to right, var(--secondary), #34495e);
        }
        
        button.accent {
            background: linear-gradient(to right, var(--accent), #2980b9);
        }
        
        #hasilKarbon {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(to right, #e8f5e9, #c8e6c9);
            border-radius: 10px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            color: var(--primary);
            border: 2px dashed #4caf50;
            display: none;
        }
        
        .info-text {
            font-size: 0.9em;
            color: var(--gray);
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Certificate Styles */
        .certificate-container {
            display: none;
            margin-top: 40px;
            text-align: center;
        }
        
        .certificate {
            background: linear-gradient(to bottom right, #ffffff, #f9f9f9);
            border: 15px solid var(--primary);
            border-radius: 15px;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .certificate::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path fill="none" stroke="%2327ae60" stroke-width="1" opacity="0.1" d="M20,20 Q40,5 60,20 T100,20 M20,50 Q40,35 60,50 T100,50 M20,80 Q40,65 60,80 T100,80 M20,110 Q40,95 60,110 T100,110 M20,140 Q40,125 60,140 T100,140 M20,170 Q40,155 60,170 T100,170 M140,20 Q160,5 180,20 T200,20 M140,50 Q160,35 180,50 T200,50 M140,80 Q160,65 180,80 T200,80 M140,110 Q160,95 180,110 T200,110 M140,140 Q160,125 180,140 T200,140 M140,170 Q160,155 180,170 T200,170"/></svg>');
            background-repeat: repeat;
            opacity: 0.2;
            z-index: 0;
        }
        
        .certificate-content {
            position: relative;
            z-index: 1;
        }
        
        .certificate-title {
            font-size: 36px;
            color: var(--secondary);
            margin-bottom: 25px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .certificate-subtitle {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .user-name {
            font-size: 32px;
            font-weight: bold;
            color: var(--secondary);
            margin: 20px 0;
            padding: 10px;
            border-top: 2px dashed var(--primary);
            border-bottom: 2px dashed var(--primary);
            display: inline-block;
        }
        
        .certificate-text {
            font-size: 20px;
            color: #555;
            margin: 15px 0;
            line-height: 1.6;
        }
        
        .carbon-value {
            font-size: 52px;
            font-weight: bold;
            color: var(--danger);
            margin: 30px 0;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .certificate-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
            text-align: left;
        }
        
        .certificate-details div {
            background: rgba(39, 174, 96, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .certificate-details h4 {
            color: var(--primary);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 5px;
        }
        
        .certificate-date {
            margin-top: 20px;
            font-size: 18px;
            color: var(--gray);
        }
        
        .signature {
            margin-top: 40px;
            display: flex;
            justify-content: space-around;
            border-top: 2px solid var(--border);
            padding-top: 20px;
        }
        
        .signature div {
            text-align: center;
            width: 45%;
        }
        
        .signature p {
            margin-top: 60px;
            border-top: 1px solid var(--gray);
            padding-top: 10px;
            font-size: 16px;
            color: var(--gray);
        }
        
        .nft-badge {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            margin-top: 15px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--border);
        }
        
        .tip-section {
            background: #e3f2fd;
            border-left: 4px solid var(--accent);
            padding: 20px;
            border-radius: 0 12px 12px 0;
            margin-top: 35px;
        }
        
        .tip-section h3 {
            color: var(--accent);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tip-section ul {
            padding-left: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .tip-section li {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .tip-section li i {
            color: var(--primary);
            min-width: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .certificate {
                padding: 20px;
            }
            
            .certificate-title {
                font-size: 28px;
            }
            
            .certificate-subtitle {
                font-size: 20px;
            }
            
            .carbon-value {
                font-size: 42px;
            }
            
            .tip-section ul {
                grid-template-columns: 1fr;
            }
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: var(--gray);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--secondary);
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.5s, fadeOut 0.5s 2.5s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-leaf"></i>
            </div>
            <h1>Kalkulator Jejak Karbon Pribadi</h1>
            <p class="intro">Hitung jejak karbon Anda secara lengkap dan dapatkan sertifikat digital NFT sebagai bentuk komitmen terhadap lingkungan</p>
        </header>
        
        <div class="form-container">
            <section class="form-section">
                <h2><i class="fas fa-user"></i> Data Pribadi</h2>
                
                <div class="form-group">
                    <label for="namaLengkap">Nama Lengkap:</label>
                    <input type="text" id="namaLengkap" placeholder="Contoh: Budi Santoso">
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" placeholder="Contoh: nama@email.com">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="provinsi">Provinsi:</label>
                        <select id="provinsi">
                            <option value="">Pilih Provinsi</option>
                            <option value="dki">DKI Jakarta</option>
                            <option value="jabar">Jawa Barat</option>
                            <option value="jateng">Jawa Tengah</option>
                            <option value="jatim">Jawa Timur</option>
                            <option value="bali">Bali</option>
                            <option value="sumut">Sumatera Utara</option>
                            <option value="sulsel">Sulawesi Selatan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="kota">Kota:</label>
                        <input type="text" id="kota" placeholder="Contoh: Jakarta Selatan">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="alamat">Alamat Lengkap:</label>
                    <textarea id="alamat" rows="3" placeholder="Contoh: Jl. Merdeka No. 123"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="profesi">Profesi:</label>
                    <select id="profesi">
                        <option value="">Pilih Profesi</option>
                        <option value="pns">PNS</option>
                        <option value="swasta">Karyawan Swasta</option>
                        <option value="wirausaha">Wirausaha</option>
                        <option value="mahasiswa">Mahasiswa/Pelajar</option>
                        <option value="profesional">Profesional</option>
                        <option value="lainnya">Lainnya</option>
                    </select>
                </div>
            </section>
            
            <section class="form-section">
                <h2><i class="fas fa-chart-line"></i> Aktivitas Karbon</h2>
                
                <div class="form-group">
                    <label for="listrik">Pemakaian Listrik Bulanan (kWh):</label>
                    <input type="number" id="listrik" placeholder="Contoh: 200" min="0">
                    <p class="info-text">Rata-rata penggunaan listrik rumah tangga per bulan</p>
                </div>
                
                <div class="form-group">
                    <label for="transportasi">Jarak Tempuh Transportasi Pribadi (km/bulan):</label>
                    <input type="number" id="transportasi" placeholder="Contoh: 300" min="0">
                    <p class="info-text">Total jarak tempuh kendaraan pribadi Anda per bulan</p>
                </div>
                
                <div class="form-group">
                    <label for="jenisBahanBakar">Jenis Bahan Bakar Kendaraan:</label>
                    <select id="jenisBahanBakar">
                        <option value="bensin">Bensin</option>
                        <option value="diesel">Diesel</option>
                        <option value="hybrid">Hybrid</option>
                        <option value="elektrik">Elektrik</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="penerbangan">Jumlah Jam Penerbangan (per bulan):</label>
                    <input type="number" id="penerbangan" placeholder="Contoh: 2" min="0" step="0.5">
                </div>
                
                <div class="form-group">
                    <label for="konsumsiDaging">Konsumsi Daging (kg/minggu):</label>
                    <input type="number" id="konsumsiDaging" placeholder="Contoh: 2.5" min="0" step="0.1">
                </div>
                
                <div class="form-group">
                    <label for="sampahPlastik">Sampah Plastik (kg/minggu):</label>
                    <input type="number" id="sampahPlastik" placeholder="Contoh: 1.2" min="0" step="0.1">
                </div>
            </section>
        </div>
        
        <button onclick="hitungKarbon()">
            <i class="fas fa-calculator"></i> Hitung Jejak Karbon
        </button>

        <div id="hasilKarbon">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" id="carbonProgress" style="width: 0%"></div>
                </div>
                <div class="progress-labels">
                    <span>Rendah</span>
                    <span>Sedang</span>
                    <span>Tinggi</span>
                </div>
            </div>
            <p>Jejak Karbon Anda: <span id="totalKarbon">0</span> kg CO2e/bulan</p>
            <p id="carbonCategory" style="font-size: 18px; margin-top: 10px;"></p>
        </div>
        
        <button id="generateSertifikatBtn" style="display: none;" onclick="generateCertificate()">
            <i class="fas fa-certificate"></i> Generate Sertifikat Digital
        </button>
        
        <div class="certificate-container" id="certificateContainer">
            <div class="certificate">
                <div class="certificate-content">
                    <div class="certificate-title">Sertifikat Kesadaran Jejak Karbon</div>
                    <div class="certificate-subtitle">Diberikan Kepada</div>
                    <div class="user-name" id="certUserName">Budi Santoso</div>
                    
                    <p class="certificate-text">Atas partisipasi dalam menghitung dan menyadari</p>
                    <p class="certificate-text">dampak lingkungan dari aktivitas sehari-hari</p>
                    
                    <div class="carbon-value" id="certCarbonValue">0 kg CO2e</div>
                    
                    <p class="certificate-text">sebagai bentuk komitmen terhadap kelestarian lingkungan</p>
                    
                    <div class="certificate-details">
                        <div>
                            <h4><i class="fas fa-map-marker-alt"></i> Lokasi</h4>
                            <p id="certLocation">Jakarta, Indonesia</p>
                        </div>
                        <div>
                            <h4><i class="fas fa-id-card"></i> Profesi</h4>
                            <p id="certProfession">Karyawan Swasta</p>
                        </div>
                    </div>
                    
                    <div class="certificate-date">
                        <i class="fas fa-calendar-alt"></i> Tanggal: <span id="certDate">17 Agustus 2025</span>
                    </div>
                    
                    <div class="nft-badge">
                        <i class="fas fa-medal"></i> Sertifikat Digital NFT
                    </div>
                    
                    <!-- Di dalam certificate-content -->
<div id="qrCodeContainer" style="display: none; margin: 20px auto; text-align: center;">
    <canvas id="qrCanvas" width="200" height="200"></canvas>
    <p style="font-size: 14px; margin-top: 10px;">Scan untuk melihat di blockchain</p>
</div>

                    
                    <div class="signature">
                        <div>
                            <p id="certUserName2">Budi Santoso</p>
                            <p>Pemilik Sertifikat</p>
                        </div>
                        <div>
                            <p>Bumi Kita</p>
                            <p>Planet Hijau</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="downloadBtn" class="accent" onclick="downloadCertificate()">
                <i class="fas fa-download"></i> Unduh Sertifikat
            </button>
            
            <button id="mintNFTBtn" class="secondary" onclick="mintNFT()" style="margin-top: 15px;">
                <i class="fas fa-coins"></i> Mint sebagai NFT
            </button>
        </div>
        
        
<div id="historySection" style="margin-top: 30px; display: none;">
    <h3><i class="fas fa-history"></i> Riwayat Perhitungan</h3>
    <div id="historyList"></div>
</div>

        
<div id="emissionBreakdown" style="display: none; margin-top: 20px;">
    <h3><i class="fas fa-chart-pie"></i> Detail Kontribusi Emisi</h3>
    <div class="breakdown-item">
        <div class="breakdown-label">Listrik</div>
        <div class="breakdown-bar-container">
            <div class="breakdown-bar" id="barListrik"></div>
        </div>
        <div class="breakdown-value" id="valueListrik">0 kg</div>
    </div>
    <!-- Tambahkan elemen serupa untuk kategori lain -->
</div>

        
        
        <div class="tip-section">
            <h3><i class="fas fa-lightbulb"></i> Tips Mengurangi Jejak Karbon:</h3>
            <ul>
                <li><i class="fas fa-bus"></i> Gunakan transportasi umum atau bersepeda</li>
                <li><i class="fas fa-plug"></i> Matikan peralatan elektronik saat tidak digunakan</li>
                <li><i class="fas fa-seedling"></i> Kurangi konsumsi daging dan produk hewani</li>
                <li><i class="fas fa-tree"></i> Tanam pohon atau ikut program penghijauan</li>
                <li><i class="fas fa-recycle"></i> Terapkan prinsip 3R (Reduce, Reuse, Recycle)</li>
                <li><i class="fas fa-solar-panel"></i> Gunakan energi terbarukan jika memungkinkan</li>
                <li><i class="fas fa-shopping-bag"></i> Kurangi penggunaan plastik sekali pakai</li>
                <li><i class="fas fa-home"></i> Optimalkan insulasi rumah untuk efisiensi energi</li>
            </ul>
        </div>
        
        <div class="footer">
            <p>© 2025 Kalkulator Jejak Karbon Pribadi | Data emisi karbon bersifat perkiraan dan dapat berbeda berdasarkan wilayah dan kondisi aktual</p>
            <p style="margin-top: 10px;">Didukung oleh teknologi blockchain untuk sertifikat NFT</p>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> <span id="notificationText">Operasi berhasil!</span>
    </div>
    

<div id="historySection" style="margin-top: 30px; display: none;">
    <h3><i class="fas fa-history"></i> Riwayat Perhitungan</h3>
    <div id="historyList"></div>
</div>


    <script>

       // Di dalam script
const faktorEmisi = {
    listrik: 0.85, // kg CO2e per kWh (rata-rata Indonesia)
    bensinPerKm: 0.15, // kg CO2e per km (untuk BBM dengan oktan 90)
    dieselPerKm: 0.18, // kg CO2e per km
    hybridPerKm: 0.08, // kg CO2e per km
    elektrikPerKm: 0.03, // kg CO2e per km (asumsi listrik dari grid)
    penerbanganPerJam: 85, // kg CO2e per jam penerbangan
    dagingPerKg: 25, // kg CO2e per kg daging sapi
    plastikPerKg: 5, // kg CO2e per kg plastik
    kertasPerKg: 1.3 // kg CO2e per kg kertas
};
        
        async function mintNFT() {
        if (totalJejakKarbon <= 0) {
            showNotification('Silakan generate sertifikat terlebih dahulu');
            return;
        }

        showNotification('Minting sertifikat sebagai NFT...');

        try {
            const location = `${userData.kota}, ${document.querySelector('#provinsi option:checked').textContent || 'Indonesia'}`;
            
            // Data payload untuk Thirdweb
            const nftData = {
                user: userData.nama,
                email: userData.email,
                carbonFootprint: totalJejakKarbon.toFixed(2),
                location: location,
                profession: document.querySelector('#profesi option:checked').textContent || '',
                date: new Date().toISOString(),
                contractAddress: "0xcEcaab4eb1222244Ea0cF4428d700C282F0f3830",
                chain: "base"
            };

            // Kirim data ke Thirdweb webhook
            const response = await fetch(
                "https://weueopblwiliyjqaaqvb.supabase.co/functions/v1/thirdweb-nft-webhook", 
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(nftData)
                }
            );

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            console.log('NFT minting response:', result);
            
            // Update UI untuk menampilkan status sukses
            showNotification('Sertifikat NFT berhasil dibuat!');
            document.querySelector('.nft-badge').innerHTML = 
                '<i class="fas fa-check-circle"></i> Sertifikat Digital NFT (Terverifikasi di Blockchain)';
            document.querySelector('.nft-badge').style.background = 'linear-gradient(135deg, #00b09b, #96c93d)';
            
            // Tampilkan link explorer jika tersedia
            if (result.explorerUrl) {
                showNotification(`Lihat NFT di explorer: ${result.explorerUrl}`);
            }
            
        } catch (error) {
            console.error('Error minting NFT:', error);
            showNotification('Gagal membuat NFT: ' + error.message);
        }
    }
        
        let totalJejakKarbon = 0;
        let userData = {};
        
        function hitungKarbon() {
            // Mengambil data pribadi
            userData = {
                nama: document.getElementById('namaLengkap').value || 'Pengguna',
                email: document.getElementById('email').value || '',
                provinsi: document.getElementById('provinsi').value || '',
                kota: document.getElementById('kota').value || '',
                alamat: document.getElementById('alamat').value || '',
                profesi: document.getElementById('profesi').value || ''
            };
            
            // Validasi data pribadi
            if (!userData.nama || !userData.email || !userData.provinsi || !userData.kota) {
                showNotification('Harap isi semua data pribadi terlebih dahulu');
                return;
            }
            
            // Mengambil data aktivitas
            const listrik = parseFloat(document.getElementById('listrik').value) || 0;
            const transportasi = parseFloat(document.getElementById('transportasi').value) || 0;
            const jenisBahanBakar = document.getElementById('jenisBahanBakar').value;
            const penerbangan = parseFloat(document.getElementById('penerbangan').value) || 0;
            const konsumsiDaging = parseFloat(document.getElementById('konsumsiDaging').value) || 0;
            const sampahPlastik = parseFloat(document.getElementById('sampahPlastik').value) || 0;
            
            // Validasi input aktivitas
            if (listrik === 0 && transportasi === 0 && penerbangan === 0 && konsumsiDaging === 0 && sampahPlastik === 0) {
                showNotification('Silakan isi setidaknya satu bidang aktivitas');
                return;
            }

            // Menghitung emisi untuk setiap kategori
            const emisiListrik = listrik * faktorEmisi.listrik;
            
            let emisiTransportasi = 0;
            switch(jenisBahanBakar) {
                case 'bensin':
                    emisiTransportasi = transportasi * faktorEmisi.bensinPerKm;
                    break;
                case 'diesel':
                    emisiTransportasi = transportasi * faktorEmisi.dieselPerKm;
                    break;
                case 'hybrid':
                    emisiTransportasi = transportasi * faktorEmisi.hybridPerKm;
                    break;
                case 'elektrik':
                    emisiTransportasi = transportasi * faktorEmisi.elektrikPerKm;
                    break;
            }
            
            const emisiPenerbangan = penerbangan * faktorEmisi.penerbanganPerJam;
            const emisiDaging = konsumsiDaging * 4 * faktorEmisi.dagingPerKg; // 4 minggu dalam sebulan
            const emisiSampah = sampahPlastik * 4 * faktorEmisi.plastikPerKg;
            
            // Total jejak karbon
            totalJejakKarbon = emisiListrik + emisiTransportasi + emisiPenerbangan + emisiDaging + emisiSampah;
            
            <!-- Di dalam script -->
function showEmissionBreakdown(emisiListrik, emisiTransportasi, emisiPenerbangan, emisiDaging, emisiSampah) {
    const container = document.getElementById('emissionBreakdown');
    container.style.display = 'block';
    
    const total = emisiListrik + emisiTransportasi + emisiPenerbangan + emisiDaging + emisiSampah;
    
    // Update setiap bar
    document.getElementById('barListrik').style.width = `${(emisiListrik/total)*100}%`;
    document.getElementById('valueListrik').textContent = `${emisiListrik.toFixed(2)} kg`;
    
    // ... lakukan hal yang sama untuk kategori lainnya ...
}
            
            
            
            // Menampilkan hasil
            document.getElementById('totalKarbon').textContent = totalJejakKarbon.toFixed(2);
            document.getElementById('hasilKarbon').style.display = 'block';
            
            // Update progress bar
            let progressWidth = 0;
            let carbonCategory = "";
            if (totalJejakKarbon < 200) {
                progressWidth = 25;
                carbonCategory = "Rendah (Ramah Lingkungan)";
            } else if (totalJejakKarbon < 500) {
                progressWidth = 50;
                carbonCategory = "Sedang (Rata-rata)";
            } else if (totalJejakKarbon < 1000) {
                progressWidth = 75;
                carbonCategory = "Tinggi (Perlu Perbaikan)";
            } else {
                progressWidth = 95;
                carbonCategory = "Sangat Tinggi (Perlu Tindakan Segera)";
            }
            
            document.getElementById('carbonProgress').style.width = progressWidth + '%';
            document.getElementById('carbonCategory').textContent = "Kategori: " + carbonCategory;
            
            // Tampilkan tombol generate sertifikat
            document.getElementById('generateSertifikatBtn').style.display = 'flex';
            
            // Sembunyikan sertifikat jika sudah ada
            document.getElementById('certificateContainer').style.display = 'none';
            
            showNotification('Perhitungan jejak karbon berhasil!');
        }
        
        function generateCertificate() {
            if (totalJejakKarbon <= 0) {
                showNotification('Silakan hitung jejak karbon terlebih dahulu');
                return;
            }
            
            // Set data sertifikat
            document.getElementById('certUserName').textContent = userData.nama;
            document.getElementById('certUserName2').textContent = userData.nama;
            document.getElementById('certLocation').textContent = `${userData.kota}, ${document.querySelector('#provinsi option:checked').textContent || 'Indonesia'}`;
            document.getElementById('certProfession').textContent = document.querySelector('#profesi option:checked').textContent || 'Pengguna';
            
            // Set tanggal sertifikat
            const now = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('certDate').textContent = now.toLocaleDateString('id-ID', options);
            
            // Set nilai karbon
            document.getElementById('certCarbonValue').textContent = totalJejakKarbon.toFixed(2) + " kg CO2e";
            
            // Tampilkan sertifikat
            document.getElementById('certificateContainer').style.display = 'block';
            
            // Scroll ke sertifikat
            document.getElementById('certificateContainer').scrollIntoView({ behavior: 'smooth' });
            
            showNotification('Sertifikat digital berhasil dibuat!');
        }
        
        function downloadCertificate() {
            if (totalJejakKarbon <= 0) {
                showNotification('Silakan generate sertifikat terlebih dahulu');
                return;
            }
            
            // Buat nama file
            const now = new Date();
            const formattedDate = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}`;
            const filename = `sertifikat-jejak-karbon-${formattedDate}.pdf`;
            
            showNotification(`Sertifikat "${filename}" berhasil diunduh!`);
            
            // Simulasi unduhan
            // Dalam implementasi nyata, gunakan library seperti jsPDF untuk membuat PDF
        }
        
        function mintNFT() {
            if (totalJejakKarbon <= 0) {
                showNotification('Silakan generate sertifikat terlebih dahulu');
                return;
            
    // Tampilkan loading state
    const mintButton = document.getElementById('mintNFTBtn');
    const originalText = mintButton.innerHTML;
    mintButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
    mintButton.disabled = true;
    
    try {
        // ... proses minting ...
        
        // Setelah selesai, kembalikan ke state semula
        mintButton.innerHTML = originalText;
        mintButton.disabled = false;
        
    } catch (error) {
        // ... error handling ...
        mintButton.innerHTML = originalText;
        mintButton.disabled = false;
    }
}
               
            
            
            // Simulasi minting NFT
            showNotification('Minting sertifikat sebagai NFT...');
            
            
            
            
            // Simulasi koneksi ke webhook
            setTimeout(() => {
                // URL webhook untuk minting NFT
                const nftWebhook = "https://weueopblwiliyjqaaqvb.supabase.co/functions/v1/nft-mint-webhook";
                const thirdwebWebhook = "https://weueopblwiliyjqaaqvb.supabase.co/functions/v1/thirdweb-nft-webhook";
                
                // Data yang akan dikirim (dalam implementasi nyata, gunakan fetch API)
                const nftData = {
                    user: userData.nama,
                    email: userData.email,
                    carbonFootprint: totalJejakKarbon.toFixed(2),
                    location: `${userData.kota}, ${document.querySelector('#provinsi option:checked').textContent || 'Indonesia'}`,
                    timestamp: new Date().toISOString()
                };
                
                // Simulasi pengiriman data ke webhook
                console.log('Mengirim data ke webhook NFT:', nftWebhook, nftData);
                console.log('Mengirim data ke Thirdweb webhook:', thirdwebWebhook, nftData);
                
                // Tampilkan notifikasi sukses
                showNotification('Sertifikat NFT berhasil dibuat!');
                
                // Tampilkan efek visual
                document.querySelector('.nft-badge').innerHTML = 
                    '<i class="fas fa-check-circle"></i> Sertifikat Digital NFT (Terverifikasi di Blockchain)';
                document.querySelector('.nft-badge').style.background = 'linear-gradient(135deg, #00b09b, #96c93d)';
                
            }, 2000);
        }
        
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.style.display = 'block';
            
            // Sembunyikan notifikasi setelah 3 detik
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        function showQRCode(url) {
    const container = document.getElementById('qrCodeContainer');
    container.style.display = 'block';
    
    const canvas = document.getElementById('qrCanvas');
    new QRious({
        element: canvas,
        value: url,
        size: 200
    });
}

<!-- Di dalam script -->
function saveToHistory() {
    const history = JSON.parse(localStorage.getItem('carbonHistory') || []);
    const entry = {
        date: new Date().toISOString(),
        footprint: totalJejakKarbon,
        location: `${userData.kota}, ${document.querySelector('#provinsi option:checked').textContent || 'Indonesia'}`,
        profession: document.querySelector('#profesi option:checked').textContent || ''
    };
    
    history.unshift(entry); // Tambahkan di awal
    localStorage.setItem('carbonHistory', JSON.stringify(history));
    displayHistory(history);
}

function displayHistory(history) {
    const container = document.getElementById('historyList');
    const section = document.getElementById('historySection');
    
    if (history.length === 0) {
        section.style.display = 'none';
        return;
    }
    
    section.style.display = 'block';
    container.innerHTML = '';
    
    history.forEach(entry => {
        const entryEl = document.createElement('div');
        entryEl.className = 'history-entry';
        entryEl.innerHTML = `
            <p><strong>${new Date(entry.date).toLocaleDateString('id-ID')}</strong> - ${entry.footprint.toFixed(2)} kg CO2e</p>
            <p>${entry.location} • ${entry.profession}</p>
        `;
        container.appendChild(entryEl);
    });
}

// Panggil saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
    const history = JSON.parse(localStorage.getItem('carbonHistory') || []);
    displayHistory(history);
});




        
        
        // Inisialisasi data contoh untuk demo
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('namaLengkap').value = 'Budi Santoso';
            document.getElementById('email').value = 'budi@example.com';
            document.getElementById('provinsi').value = 'dki';
            document.getElementById('kota').value = 'Jakarta Selatan';
            document.getElementById('alamat').value = 'Jl. Sudirman No. 123';
            document.getElementById('profesi').value = 'swasta';
            document.getElementById('listrik').value = '250';
            document.getElementById('transportasi').value = '350';
            document.getElementById('penerbangan').value = '2';
            document.getElementById('konsumsiDaging').value = '3';
            document.getElementById('sampahPlastik').value = '1.5';
        });
    </script>
</body>
</html>